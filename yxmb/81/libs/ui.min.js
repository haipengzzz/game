function ui(){}ui.prototype.init=function(){};main.instance.ui=new ui();ui.prototype.closePanel=function(){core.status.boxAnimateObjs=[];core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.unLockControl();core.status.event.data=null;core.status.event.id=null;core.status.event.selection=null;core.status.event.ui=null};ui.prototype.drawTextBox=function(b){var m=null,q=null,n=null,l=null;if(b.indexOf("\t[")==0||b.indexOf("\\t[")==0){var o=b.indexOf("]");if(o>=0){var w=b.substring(2,o);if(b.indexOf("\\t[")==0){w=b.substring(3,o)}b=b.substring(o+1);var v=w.split(",");if(v.length==1){m=v[0];if(m!="hero"){var f=core.material.enemys[m];if(core.isset(f)){q=core.material.enemys[m].name;n=core.material.images.enemys;l=core.material.icons.enemys[m]}else{q=m;m="npc";n=null;l=null}}}else{m="npc";q=v[0];n=core.material.images.npcs;l=core.material.icons.npcs[v[1]]}}}var x=core.status.textAttribute||core.initStatus.textAttribute;var r=x.position,s=null,t=null,B=0;if(b.indexOf("\b[")==0||b.indexOf("\\b[")==0){var o=b.indexOf("]");if(o>=0){var w=b.substring(2,o);if(b.indexOf("\\b[")==0){w=b.substring(3,o)}b=b.substring(o+1);var v=w.split(",");if(v[0]=="up"||v[0]=="center"||v[0]=="down"){r=v[0];if(core.status.event.id=="action"){s=core.status.event.data.x;t=core.status.event.data.y}if(v.length>=2){if(v[1]=="hero"){s=core.getHeroLoc("x");t=core.getHeroLoc("y");B=core.material.icons.hero.height-32}else{if(v.length>=3){s=parseInt(v[1]);t=parseInt(v[2])}}}}}}b=core.replaceText(b);var a=core.canvas.ui.createPattern(core.material.ground,"repeat");core.status.boxAnimateObjs=[];core.clearMap("ui",0,0,416,416);var p=10,u=416-2*p;var c=p+25;if(m=="hero"||core.isset(l)){c=p+63}var z=u-(c-p)-13;var e=core.splitLines("ui",b,z,"16px Verdana");var g=20+21*(e.length+1)+(m=="hero"?core.material.icons.hero.height-10:core.isset(q)?32-10:0);var A=6,C=22;var y;if(r=="center"){y=(416-g)/2}else{if(r=="up"){if(s==null||t==null){y=5}else{y=32*t-g-B-C}}else{if(r=="down"){if(s==null||t==null){y=416-g-5}else{y=32*t+32+C}}}}core.setAlpha("ui",x.background[3]);core.setFillStyle("ui",core.arrayToRGB(x.background));core.setStrokeStyle("ui","#FFFFFF");core.fillRect("ui",p,y,u,g);core.strokeRect("ui",p-1,y-1,u+1,g+1,"#FFFFFF",2);var A=6;if(r=="up"&&core.isset(s)&&core.isset(t)){core.canvas.ui.clearRect(32*s+A,y+g-1,32-2*A,2);core.canvas.ui.beginPath();core.canvas.ui.moveTo(32*s+A-1,y+g-1);core.canvas.ui.lineTo(32*s+16,y+g+C-2);core.canvas.ui.lineTo(32*s+32-A+1,y+g-1);core.canvas.ui.moveTo(32*s+A-1,y+g-1);core.canvas.ui.closePath();core.canvas.ui.fill();core.drawLine("ui",32*s+A,y+g,32*s+16,y+g+C-2);core.drawLine("ui",32*s+32-A,y+g,32*s+16,y+g+C-2)}if(r=="down"&&core.isset(s)&&core.isset(t)){core.canvas.ui.clearRect(32*s+A,y-2,32-2*A,3);core.canvas.ui.beginPath();core.canvas.ui.moveTo(32*s+A-1,y+1);core.canvas.ui.lineTo(32*s+16-1,y-C+2);core.canvas.ui.lineTo(32*s+32-A-1,y+1);core.canvas.ui.moveTo(32*s+A-1,y+1);core.canvas.ui.closePath();core.canvas.ui.fill();core.drawLine("ui",32*s+A,y,32*s+16,y-C+2);core.drawLine("ui",32*s+32-A,y,32*s+16,y-C+2)}core.canvas.ui.textAlign="left";var d=y+35;if(core.isset(m)){d=y+57;core.setAlpha("ui",x.title[3]);core.setFillStyle("ui",core.arrayToRGB(x.title));core.setStrokeStyle("ui",core.arrayToRGB(x.title));if(m=="hero"){var h=core.material.icons.hero.height;core.strokeRect("ui",p+15-1,y+40-1,34,h+2,null,2);core.fillText("ui",core.status.hero.name,c,y+30,null,"bold 22px Verdana");core.clearMap("ui",p+15,y+40,32,h);core.fillRect("ui",p+15,y+40,32,h,a);var j=core.material.icons.hero.down;core.canvas.ui.drawImage(core.material.images.hero,j.stop*32,j.loc*h,32,h,p+15,y+40,32,h)}else{core.fillText("ui",q,c,y+30,null,"bold 22px Verdana");if(core.isset(l)){core.strokeRect("ui",p+15-1,y+40-1,34,34,null,2);core.status.boxAnimateObjs=[];core.status.boxAnimateObjs.push({bgx:p+15,bgy:y+40,bgsize:32,image:n,x:p+15,y:y+40,icon:l});core.drawBoxAnimate()}}}core.setAlpha("ui",x.text[3]);core.setFillStyle("ui",core.arrayToRGB(x.text));for(var k=0;k<e.length;k++){core.fillText("ui",e[k],c,d,null,"16px Verdana");d+=21}};ui.prototype.drawChoices=function(f,e){var a=core.canvas.ui.createPattern(core.material.ground,"repeat");core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.setFillStyle("ui",a);core.status.event.ui={text:f,choices:e};var v=e.length;var t=85,B=416-2*t;var l=32*(v+2),b=208+l/2;if(v%2==0){b+=16}var d=b-l+56;var q=null,w=null,r=null,p=null;var j=null;var g=t+15;if(core.isset(f)){if(f.indexOf("\t[")==0){var s=f.indexOf("]");if(s>=0){var y=f.substring(2,s);f=f.substring(s+1);var x=y.split(",");if(x.length==1){q=x[0];if(q!="hero"){var k=core.material.enemys[q];if(core.isset(k)){w=core.material.enemys[q].name;r=core.material.images.enemys;p=core.material.icons.enemys[q]}else{w=q;q="npc";r=null;p=null}}}else{q="npc";w=x[0];r=core.material.images.npcs;p=core.material.icons.npcs[x[1]]}}}f=core.replaceText(f);if(q=="hero"||core.isset(p)){g=t+60}j=core.splitLines("ui",f,B-(g-t)-10,"bold 15px Verdana");var c=0;if(w!=null){c+=25}c+=j.length*20;l+=c}var A=b-l;core.fillRect("ui",t,A,B,l,a);core.strokeRect("ui",t-1,A-1,B+1,l+1,"#FFFFFF",2);if(core.isset(j)){var h=A+35;if(core.isset(q)){core.canvas.ui.textAlign="center";h=A+55;var z=t+B/2;if(q=="hero"||core.isset(p)){z+=22}if(q=="hero"){var m=core.material.icons.hero.height;core.strokeRect("ui",t+15-1,A+30-1,34,m+2,"#DDDDDD",2);core.fillText("ui",core.status.hero.name,z,A+27,"#FFD700","bold 19px Verdana");core.clearMap("ui",t+15,A+30,32,m);core.fillRect("ui",t+15,A+30,32,m,a);var n=core.material.icons.hero.down;core.canvas.ui.drawImage(core.material.images.hero,n.stop*32,n.loc*m,32,m,t+15,A+30,32,m)}else{core.fillText("ui",w,z,A+27,"#FFD700","bold 19px Verdana");if(core.isset(p)){core.strokeRect("ui",t+15-1,A+30-1,34,34,"#DDDDDD",2);core.status.boxAnimateObjs=[];core.status.boxAnimateObjs.push({bgx:t+15,bgy:A+30,bgsize:32,image:r,x:t+15,y:A+30,icon:p});core.drawBoxAnimate()}}}core.canvas.ui.textAlign="left";for(var o=0;o<j.length;o++){core.fillText("ui",j[o],g,h,"#FFFFFF","bold 15px Verdana");h+=20}}core.canvas.ui.textAlign="center";for(var o=0;o<e.length;o++){core.fillText("ui",core.replaceText(e[o].text||e[o]),208,d+32*o,"#FFFFFF","bold 17px Verdana")}if(e.length>0){if(!core.isset(core.status.event.selection)){core.status.event.selection=0}if(core.status.event.selection<0){core.status.event.selection=0}if(core.status.event.selection>=e.length){core.status.event.selection=e.length-1}var u=core.canvas.ui.measureText(core.replaceText(e[core.status.event.selection].text||e[core.status.event.selection])).width;core.strokeRect("ui",208-u/2-5,d+32*core.status.event.selection-20,u+10,28,"#FFD700",2)}return};ui.prototype.drawConfirmBox=function(l,n,j){core.lockControl();core.status.event.id="confirmBox";core.status.event.data={yes:n,no:j};core.status.event.ui=l;if(!core.isset(core.status.event.selection)||core.status.event.selection>1){core.status.event.selection=1}if(core.status.event.selection<0){core.status.event.selection=0}var a=core.canvas.ui.createPattern(core.material.ground,"repeat");core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.setFillStyle("ui",a);core.setFont("ui","bold 19px Verdana");var c=l.split("\n");var g=c.length;var h=0;for(var d in c){h=Math.max(h,core.canvas.ui.measureText(c[d]).width)}var e=Math.min(208-40-h/2,100);var m=140-(g-1)*30;var k=416-2*e,b=416-140-m;if(core.isPlaying()){core.fillRect("ui",e,m,k,b,a)}if(core.isPlaying()){core.strokeRect("ui",e-1,m-1,k+1,b+1,"#FFFFFF",2)}core.canvas.ui.textAlign="center";for(var d in c){core.fillText("ui",c[d],208,m+50+d*30,"#FFFFFF")}core.fillText("ui","确定",208-38,m+b-35,"#FFFFFF","bold 17px Verdana");core.fillText("ui","取消",208+38,m+b-35);var f=core.canvas.ui.measureText("确定").width;if(core.status.event.selection==0){core.strokeRect("ui",208-38-f/2-5,m+b-35-20,f+10,28,"#FFD700",2)}if(core.status.event.selection==1){core.strokeRect("ui",208+38-f/2-5,m+b-35-20,f+10,28,"#FFD700",2)}};ui.prototype.drawSwitchs=function(){core.status.event.id="switchs";var a=["背景音乐："+(core.musicStatus.bgmStatus?"[ON]":"[OFF]"),"背景音效："+(core.musicStatus.soundStatus?"[ON]":"[OFF]"),"战斗动画： "+(core.flags.battleAnimate?"[ON]":"[OFF]"),"怪物显伤： "+(core.flags.displayEnemyDamage?"[ON]":"[OFF]"),"领域显伤： "+(core.flags.displayExtraDamage?"[ON]":"[OFF]"),"下载离线版本","返回主菜单"];this.drawChoices(null,a)};ui.prototype.drawSettings=function(){core.status.event.id="settings";this.drawChoices(null,["系统设置","快捷商店","浏览地图","同步存档","重新开始","数据统计","操作帮助","关于本塔","返回游戏"])};ui.prototype.drawQuickShop=function(){core.status.event.id="selectShop";var d=core.status.shops,c=Object.keys(d);var a=[];for(var b=0;b<c.length;b++){a.push(d[c[b]].textInList)}a.push("返回游戏");this.drawChoices(null,a)};ui.prototype.drawBattleAnimate=function(F,e){core.lockControl();if(!core.isset(core.status.event.id)){core.status.event={id:"battle"}}var k=core.getStatus("hp"),g=core.getStatus("atk"),h=core.getStatus("def"),l=core.getStatus("mdef");var E=core.material.enemys[F];var B=E.hp,y=E.atk,z=E.def,C=E.money,A=E.experience,D=E.special;var p=0;if(core.enemys.hasSpecial(D,11)){var O=k*E.value;O=parseInt(O);if(E.add){B+=O}p+=O}k-=core.enemys.getExtraDamage(E);if(core.enemys.hasSpecial(D,10)){y=g;z=h}if(core.enemys.hasSpecial(D,2)){h=0}if(core.enemys.hasSpecial(D,3)&&z<g){z=g-1}var M=0;if(core.enemys.hasSpecial(D,1)){M=1}var N=2;if(core.enemys.hasSpecial(D,4)){N=3}if(core.enemys.hasSpecial(D,5)){N=4}if(core.enemys.hasSpecial(D,6)){N=1+(E.n||4)}if(core.enemys.hasSpecial(D,7)){p+=parseInt(core.values.breakArmor*h)}if(core.enemys.hasSpecial(D,9)){p+=parseInt(core.values.purify*l)}l-=p;if(l<0){k+=l;l=0}var J=core.enemys.getSpecialText(F);var a=core.canvas.ui.createPattern(core.material.ground,"repeat");core.clearMap("ui",0,0,416,416);var r=10,G=416-2*r;var v=3;if(core.flags.enableMDef||core.flags.enableMoney||core.flags.enableExperience){v=4}if(core.flags.enableMoney&&core.flags.enableExperience){v=5}var u=60;var f=u*v+50;var L=(416-f)/2,c=f;core.setAlpha("ui",0.85);core.fillRect("ui",r,L,G,c,"#000000");core.setAlpha("ui",1);core.strokeRect("ui",r-1,L-1,G+1,c+1,"#FFFFFF",2);core.clearMap("data",0,0,416,416);clearInterval(core.interval.tipAnimate);core.setAlpha("data",1);core.setOpacity("data",1);core.status.boxAnimateObjs=[];var x=35;var d=40;var m=core.material.icons.hero.height;core.strokeRect("ui",r+x-1,L+x-1,d+2,m+d-32+2,"#FFD700",2);core.strokeRect("ui",r+G-x-d-1,L+x-1,d+2,d+2);core.canvas.ui.textAlign="center";core.fillText("ui",core.status.hero.name,r+x+d/2,L+x+m+40,"#FFD700","bold 22px Verdana");core.fillText("ui","怪物",r+G-x-d/2,L+x+32+40);for(var o=0,q=0;o<J.length;o++){if(J[o]!=""){core.fillText("ui",J[o],r+G-x-d/2,L+x+32+44+20*(++q),"#FF6A6A","15px Verdana")}}core.clearMap("ui",r+x,L+x,d,m+d-32);core.fillRect("ui",r+x,L+x,d,m+d-32,a);var n=core.material.icons.hero.down;core.canvas.ui.drawImage(core.material.images.hero,n.stop*32,n.loc*m,32,m,r+x+(d-32)/2,L+x+(d-32)/2,32,m);core.status.boxAnimateObjs=[];core.status.boxAnimateObjs.push({bgx:r+G-x-40,bgy:L+x,bgsize:d,image:core.material.images.enemys,x:r+G-x-40+(d-32)/2,y:L+x+(d-32)/2,icon:core.material.icons.enemys[F]});core.drawBoxAnimate();var w=80;var t=r+x+d+10;var s=t+w;var H=r+G-x-d-10;var I=H-w;core.canvas.ui.textAlign="left";var K=L+x+10;core.fillText("ui","生命值",t,K,"#DDDDDD","16px Verdana");core.drawLine("ui",t,K+8,s,K+8,"#FFFFFF",2);core.canvas.data.textAlign="right";core.fillText("data",k,s,K+26,"#DDDDDD","bold 16px Verdana");K+=u;core.canvas.ui.textAlign="left";core.fillText("ui","攻击",t,K,"#DDDDDD","16px Verdana");core.drawLine("ui",t,K+8,s,K+8,"#FFFFFF",2);core.canvas.ui.textAlign="right";core.fillText("ui",g,s,K+26,"#DDDDDD","bold 16px Verdana");K+=u;core.canvas.ui.textAlign="left";core.fillText("ui","防御",t,K,"#DDDDDD","16px Verdana");core.drawLine("ui",t,K+8,s,K+8,"#FFFFFF",2);core.canvas.ui.textAlign="right";core.fillText("ui",h,s,K+26,"#DDDDDD","bold 16px Verdana");if(core.flags.enableMDef){K+=u;core.canvas.ui.textAlign="left";core.fillText("ui","护盾",t,K,"#DDDDDD","16px Verdana");core.drawLine("ui",t,K+8,s,K+8,"#FFFFFF",2);core.canvas.data.textAlign="right";core.fillText("data",l,s,K+26,"#DDDDDD","bold 16px Verdana")}core.canvas.ui.textAlign="right";var K=L+x+10;core.fillText("ui","生命值",H,K,"#DDDDDD","16px Verdana");core.drawLine("ui",I,K+8,H,K+8,"#FFFFFF",2);core.canvas.data.textAlign="left";core.fillText("data",B,I,K+26,"#DDDDDD","bold 16px Verdana");K+=u;core.canvas.ui.textAlign="right";core.fillText("ui","攻击",H,K,"#DDDDDD","16px Verdana");core.drawLine("ui",I,K+8,H,K+8,"#FFFFFF",2);core.canvas.ui.textAlign="left";core.fillText("ui",y,I,K+26,"#DDDDDD","bold 16px Verdana");K+=u;core.canvas.ui.textAlign="right";core.fillText("ui","防御",H,K,"#DDDDDD","16px Verdana");core.drawLine("ui",I,K+8,H,K+8,"#FFFFFF",2);core.canvas.ui.textAlign="left";core.fillText("ui",z,I,K+26,"#DDDDDD","bold 16px Verdana");if(core.flags.enableMoney){K+=u;core.canvas.ui.textAlign="right";core.fillText("ui","金币",H,K,"#DDDDDD","16px Verdana");core.drawLine("ui",I,K+8,H,K+8,"#FFFFFF",2);core.canvas.ui.textAlign="left";core.fillText("ui",C,I,K+26,"#DDDDDD","bold 16px Verdana")}if(core.flags.enableExperience){K+=u;core.canvas.ui.textAlign="right";core.fillText("ui","经验",H,K,"#DDDDDD","16px Verdana");core.drawLine("ui",I,K+8,H,K+8,"#FFFFFF",2);core.canvas.ui.textAlign="left";core.fillText("ui",A,I,K+26,"#DDDDDD","bold 16px Verdana")}core.canvas.ui.textAlign="left";core.fillText("ui","V",s+8,208-15,"#FFFFFF","italic bold 40px Verdana");core.canvas.ui.textAlign="right";core.fillText("ui","S",I-8,208+15,"#FFFFFF","italic bold 40px Verdana");var b=setInterval(function(){core.playSound("attack.ogg");if(M==0){core.drawLine("data",r+G-x-d+6,L+x+d-6,r+G-x-6,L+x+6,"#FF0000",4);setTimeout(function(){core.clearMap("data",r+G-x-d,L+x,d,d)},250);if(g-z>0){B-=g-z}if(B<0){B=0}core.clearMap("data",I,L+x+10,w,40);core.canvas.data.textAlign="left";core.fillText("data",B,I,L+x+10+26,"#DDDDDD","bold 16px Verdana");if(core.enemys.hasSpecial(D,8)){l-=parseInt(core.values.counterAttack*g);if(l<0){k+=l;l=0}core.clearMap("data",t,L+x+10,w,40);core.canvas.data.textAlign="right";core.fillText("data",k,s,L+x+10+26,"#DDDDDD","bold 16px Verdana");if(core.flags.enableMDef){core.clearMap("data",t,L+x+10+3*u,w,40);core.fillText("data",l,s,L+x+10+26+3*u)}}}else{core.drawLine("data",r+x+6,L+x+m+(d-32)-6,r+x+d-6,L+x+6,"#FF0000",4);setTimeout(function(){core.clearMap("data",r+x,L+x,d,m+d-32)},250);var i=y-h;if(i<0){i=0}l-=i;if(l<0){k+=l;l=0}core.clearMap("data",t,L+x+10,w,40);core.canvas.data.textAlign="right";core.fillText("data",k,s,L+x+10+26,"#DDDDDD","bold 16px Verdana");if(core.flags.enableMDef){core.clearMap("data",t,L+x+10+3*u,w,40);core.fillText("data",l,s,L+x+10+26+3*u)}}M++;if(M>=N){M=0}if(k<=0||B<=0){clearInterval(b);core.status.boxAnimateObjs=[];core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.clearMap("data",0,0,416,416);if(core.status.event.id=="battle"){core.unLockControl();core.status.event.id=null}if(core.isset(e)){e()}return}},500)};ui.prototype.drawWaiting=function(e){core.lockControl();core.status.event.id="waiting";var a=core.canvas.ui.createPattern(core.material.ground,"repeat");core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.setFillStyle("ui",a);core.setFont("ui","bold 17px Verdana");var f=core.canvas.ui.measureText(e).width;var d=Math.max(f+50,220);var c=208-d/2,g=208-32-16,b=416-2*g;core.fillRect("ui",c,g,d,b,a);core.strokeRect("ui",c-1,g-1,d+1,b+1,"#FFFFFF",2);core.canvas.ui.textAlign="center";core.fillText("ui",e,208,g+56,"#FFFFFF")};ui.prototype.drawSyncSave=function(){core.status.event.id="syncSave";this.drawChoices(null,["同步存档到服务器","从服务器加载存档","存档至本地文件","从本地文件读档","下载当前录像","清空本地存档","返回主菜单"])};ui.prototype.drawSyncSelect=function(){core.status.event.id="syncSelect";this.drawChoices(null,["同步本地所有存档","只同步最新单存档","返回上级菜单"])};ui.prototype.drawLocalSaveSelect=function(){core.status.event.id="localSaveSelect";this.drawChoices(null,["下载所有存档","只下载最新单存档","返回上级菜单"])};ui.prototype.drawPagination=function(b,c){core.setFont("ui","bold 15px Verdana");core.setFillStyle("ui","#DDDDDD");var a=core.canvas.ui.measureText(b+" / "+b).width;core.canvas.ui.textAlign="left";core.fillText("ui",b+" / "+c,(416-a)/2,403);core.canvas.ui.textAlign="center";if(b>1){core.fillText("ui","上一页",208-80,403)}if(b<c){core.fillText("ui","下一页",208+80,403)}core.fillText("ui","返回游戏",370,403)};ui.prototype.drawCursor=function(){if(!core.isset(core.status.automaticRoute.cursorX)){core.status.automaticRoute.cursorX=core.getHeroLoc("x")}if(core.status.automaticRoute.cursorX<0){core.status.automaticRoute.cursorX=0}if(core.status.automaticRoute.cursorX>12){core.status.automaticRoute.cursorX=12}if(!core.isset(core.status.automaticRoute.cursorY)){core.status.automaticRoute.cursorY=core.getHeroLoc("y")}if(core.status.automaticRoute.cursorY<0){core.status.automaticRoute.cursorY=0}if(core.status.automaticRoute.cursorY>12){core.status.automaticRoute.cursorY=12}core.status.event.id="cursor";core.lockControl();core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);var a=4;core.strokeRect("ui",32*core.status.automaticRoute.cursorX+a/2,32*core.status.automaticRoute.cursorY+a/2,32-a,32-a,"#FFD700",a)};ui.prototype.drawBook=function(k){var g=core.enemys.getCurrentEnemys(core.floorIds[core.status.event.selection]);var a=core.canvas.ui.createPattern(core.material.ground,"repeat");clearInterval(core.interval.tipAnimate);core.clearMap("data",0,0,416,416);core.setOpacity("data",1);core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.setFillStyle("ui",a);core.fillRect("ui",0,0,416,416);core.setAlpha("ui",0.6);core.setFillStyle("ui","#000000");core.fillRect("ui",0,0,416,416);core.setAlpha("ui",1);core.canvas.ui.textAlign="left";core.setFont("ui","bold 15px Verdana");if(g.length==0){core.fillText("ui","本层无怪物",83,222,"#999999","bold 50px Verdana");core.canvas.ui.textAlign="center";core.fillText("ui","返回游戏",370,403,"#DDDDDD","bold 15px Verdana");return}if(k<0){k=0}if(k>=g.length){k=g.length-1}var m=6;var l=parseInt(k/m)+1;var o=parseInt((g.length-1)/m)+1;core.status.event.data=k;var n=(l-1)*m,e=Math.min(l*m,g.length);g=g.slice(n,e);core.status.boxAnimateObjs=[];for(var j=0;j<g.length;j++){var f=g[j];core.strokeRect("ui",22,62*j+22,42,42,"#DDDDDD",2);core.status.boxAnimateObjs.push({bgx:22,bgy:62*j+22,bgsize:42,image:core.material.images.enemys,x:27,y:62*j+27,icon:core.material.icons.enemys[f.id]});core.canvas.ui.textAlign="center";if(f.special==""){core.fillText("ui",f.name,115,62*j+47,"#DDDDDD","bold 17px Verdana")}else{core.fillText("ui",f.name,115,62*j+40,"#DDDDDD","bold 17px Verdana");core.fillText("ui",f.special,115,62*j+62,"#FF6A6A","bold 15px Verdana")}core.canvas.ui.textAlign="left";core.fillText("ui","生命",165,62*j+32,"#DDDDDD","13px Verdana");core.fillText("ui",f.hp,195,62*j+32,"#DDDDDD","bold 13px Verdana");core.fillText("ui","攻击",255,62*j+32,"#DDDDDD","13px Verdana");core.fillText("ui",f.atk,285,62*j+32,"#DDDDDD","bold 13px Verdana");core.fillText("ui","防御",335,62*j+32,"#DDDDDD","13px Verdana");core.fillText("ui",f.def,365,62*j+32,"#DDDDDD","bold 13px Verdana");var h=165;if(core.flags.enableMoney){core.fillText("ui","金币",165,62*j+50,"#DDDDDD","13px Verdana");core.fillText("ui",f.money,195,62*j+50,"#DDDDDD","bold 13px Verdana");h=255}if(core.flags.enableExperience){core.canvas.ui.textAlign="left";core.fillText("ui","经验",h,62*j+50,"#DDDDDD","13px Verdana");core.fillText("ui",f.experience,h+30,62*j+50,"#DDDDDD","bold 13px Verdana")}var d=281;if(core.flags.enableMoney&&core.flags.enableExperience){d=361}else{if(core.flags.enableMoney||core.flags.enableExperience){d=326}}core.canvas.ui.textAlign="center";var c=f.damage;var b="#FFFF00";if(c>=core.status.hero.hp){b="#FF0000"}if(c<=0){b="#00FF00"}if(c>=999999999){c="无法战斗"}core.fillText("ui",c,d,62*j+50,b,"bold 13px Verdana");core.canvas.ui.textAlign="left";core.fillText("ui","临界",165,62*j+68,"#DDDDDD","13px Verdana");core.fillText("ui",f.critical,195,62*j+68,"#DDDDDD","bold 13px Verdana");core.fillText("ui","减伤",255,62*j+68,"#DDDDDD","13px Verdana");core.fillText("ui",f.criticalDamage,285,62*j+68,"#DDDDDD","bold 13px Verdana");core.fillText("ui","1防",335,62*j+68,"#DDDDDD","13px Verdana");core.fillText("ui",f.defDamage,365,62*j+68,"#DDDDDD","bold 13px Verdana");if(k==n+j){core.strokeRect("ui",10,62*j+13,416-10*2,62,"#FFD700")}}core.drawBoxAnimate();this.drawPagination(l,o)};ui.prototype.drawBookDetail=function(m){var h=core.enemys.getCurrentEnemys(core.floorIds[core.status.event.selection]);if(h.length==0){return}if(m<0){m=0}if(m>=h.length){m=h.length-1}var f=h[m];var g=f.id;var k=core.enemys.getSpecialHint(core.enemys.getEnemys(g));if(k.length==0){core.drawTip("该怪物无特殊属性！");return}var b=k.join("\n");core.status.event.id="book-detail";clearInterval(core.interval.tipAnimate);core.clearMap("data",0,0,416,416);core.setOpacity("data",1);var n=10,p=416-2*n;var c=n+25;var s=p-(c-n)-13;var e=core.splitLines("data",b,s,"16px Verdana");var j=416-10-Math.min(416-24*(e.length+1)-65,250);var r=(416-j)/2,a=j;core.setAlpha("data",0.9);core.fillRect("data",n,r,p,a,"#000000");core.setAlpha("data",1);core.strokeRect("data",n-1,r-1,p+1,a+1,"#FFFFFF",2);core.canvas.data.textAlign="left";core.fillText("data",f.name,c,r+30,"#FFD700","bold 22px Verdana");var d=r+57;for(var l=0;l<e.length;l++){var q=e[l];var m=q.indexOf("：");if(m>=0){var t=q.substring(0,m+1);core.fillText("data",t,c,d,"#FF6A6A","bold 16px Verdana");var o=core.canvas.data.measureText(t).width;core.fillText("data",q.substring(m+1),c+o,d,"#FFFFFF","16px Verdana")}else{core.fillText("data",e[l],c,d,"#FFFFFF","16px Verdana")}d+=24}core.fillText("data","<点击任意位置继续>",270,r+j-13,"#CCCCCC","13px Verdana")};ui.prototype.drawFly=function(b){if(b<0){b=0}if(b>=core.status.hero.flyRange.length){b=core.status.hero.flyRange.length-1}core.status.event.data=b;var a=core.status.hero.flyRange[b];var c=core.status.maps[a].title;core.clearMap("ui",0,0,416,416);core.setAlpha("ui",0.85);core.fillRect("ui",0,0,416,416,"#000000");core.setAlpha("ui",1);core.canvas.ui.textAlign="center";core.fillText("ui","楼层跳跃",208,60,"#FFFFFF","bold 28px Verdana");core.fillText("ui","返回游戏",208,403,"#FFFFFF","bold 15px Verdana");core.fillText("ui",c,356,247,"#FFFFFF","bold 19px Verdana");if(b<core.status.hero.flyRange.length-1){core.fillText("ui","▲",356,247-64,"#FFFFFF","17px Verdana")}if(b>0){core.fillText("ui","▼",356,247+64,"#FFFFFF","17px Verdana")}core.strokeRect("ui",20,100,273,273,"#FFFFFF",2);this.drawThumbnail(a,"ui",core.status.maps[a].blocks,20,100,273)};ui.prototype.drawMaps=function(c){if(!core.isset(c)){c=core.floorIds.indexOf(core.status.floorId)}if(c<0){c=0}if(c>=core.floorIds.length){c=core.floorIds.length-1}core.lockControl();core.status.event.id="viewMaps";core.status.event.data=c;var a=core.floorIds[c];clearTimeout(core.interval.tipAnimate);core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);this.drawThumbnail(a,"ui",core.status.maps[a].blocks,0,0,416);core.clearMap("data",0,0,416,416);core.setOpacity("data",0.2);core.canvas.data.textAlign="left";core.setFont("data","16px Arial");var d=core.floors[a].title;var e=16,f=18,g=e+core.canvas.data.measureText(d).width+16,b=42;core.fillRect("data",5,5,g,b,"#000");core.setOpacity("data",0.5);core.fillText("data",d,e+5,f+15,"#fff")};ui.prototype.drawToolbox=function(f){var k=Object.keys(core.status.hero.items.tools).sort();var b=Object.keys(core.status.hero.items.constants).sort();if(!core.isset(f)){if(k.length>0){f=0}else{if(b.length>0){f=100}else{f=0}}}core.status.event.selection=f;var h;if(f<100){h=k[f]}else{h=b[f-100]}if(!core.hasItem(h)){h=null}core.status.event.data=h;core.clearMap("ui",0,0,416,416);core.setAlpha("ui",0.85);core.fillRect("ui",0,0,416,416,"#000000");core.setAlpha("ui",1);core.setFillStyle("ui","#DDDDDD");core.setStrokeStyle("ui","#DDDDDD");core.canvas.ui.lineWidth=2;core.canvas.ui.strokeWidth=2;core.canvas.ui.beginPath();core.canvas.ui.moveTo(0,130);core.canvas.ui.lineTo(416,130);core.canvas.ui.stroke();core.canvas.ui.beginPath();core.canvas.ui.moveTo(0,129);core.canvas.ui.lineTo(0,105);core.canvas.ui.lineTo(72,105);core.canvas.ui.lineTo(102,129);core.canvas.ui.fill();core.canvas.ui.beginPath();core.canvas.ui.moveTo(0,290);core.canvas.ui.lineTo(416,290);core.canvas.ui.stroke();core.canvas.ui.beginPath();core.canvas.ui.moveTo(0,289);core.canvas.ui.lineTo(0,265);core.canvas.ui.lineTo(72,265);core.canvas.ui.lineTo(102,289);core.canvas.ui.fill();core.canvas.ui.textAlign="left";core.fillText("ui","消耗道具",5,124,"#333333","bold 16px Verdana");core.fillText("ui","永久道具",5,284);if(core.isset(h)){var g=core.material.items[h];core.fillText("ui",g.name,10,32,"#FFD700","bold 20px Verdana");core.fillText("ui",g.text,10,62,"#FFFFFF","17px Verdana");core.fillText("ui","<继续点击该道具即可进行使用>",10,89,"#CCCCCC","14px Verdana")}core.canvas.ui.textAlign="right";var e=core.material.images.items;for(var c=0;c<k.length;c++){var j=k[c];var d=core.material.icons.items[j];if(c<6){core.canvas.ui.drawImage(e,0,d*32,32,32,16*(4*c+1)+5,144+5,32,32);core.fillText("ui",core.itemCount(j),16*(4*c+1)+40,144+38,"#FFFFFF","bold 14px Verdana");if(h==j){core.strokeRect("ui",16*(4*c+1)+1,144+1,40,40,"#FFD700")}}else{core.canvas.ui.drawImage(e,0,d*32,32,32,16*(4*(c-6)+1)+5,144+64+5,32,32);core.fillText("ui",core.itemCount(j),16*(4*(c-6)+1)+40,144+64+38,"#FFFFFF","bold 14px Verdana");if(h==j){core.strokeRect("ui",16*(4*(c-6)+1)+1,144+64+1,40,40,"#FFD700")}}}for(var c=0;c<b.length;c++){var a=b[c];var d=core.material.icons.items[a];if(c<6){core.canvas.ui.drawImage(e,0,d*32,32,32,16*(4*c+1)+5,304+5,32,32);if(h==a){core.strokeRect("ui",16*(4*c+1)+1,304+1,40,40,"#FFD700")}}else{core.canvas.ui.drawImage(e,0,d*32,32,32,16*(4*(c-6)+1)+5,304+64+5,32,32);if(h==a){core.strokeRect("ui",16*(4*(c-6)+1)+1,304+64+1,40,40,"#FFD700")}}}core.canvas.ui.textAlign="center";core.fillText("ui","删除道具",370,32,"#DDDDDD","bold 15px Verdana");core.fillText("ui","返回游戏",370,403,"#DDDDDD","bold 15px Verdana")};ui.prototype.drawSLPanel=function(d){if(!core.isset(d)){d=1}if(d<0){d=0}var g=parseInt(d/10),f=d%10;if(g>=30){g=29}if(f>5){f=5}d=10*g+f;core.status.event.data=d;core.clearMap("ui",0,0,416,416);core.setAlpha("ui",0.85);core.fillRect("ui",0,0,416,416,"#000000");core.setAlpha("ui",1);core.canvas.ui.textAlign="center";var j=416/6,h=117;var e=core.status.event.id=="save"?"存档":"读档";for(var b=0;b<6;b++){var c=5*g+b;var a=core.getLocalStorage(b==0?"autoSave":"save"+c,null);if(b<3){core.fillText("ui",b==0?"自动存档":e+c,(2*b+1)*j,35,"#FFFFFF","bold 17px Verdana");core.strokeRect("ui",(2*b+1)*j-h/2,50,h,h,b==f?"#FFD700":"#FFFFFF",b==f?6:2);if(core.isset(a)&&core.isset(a.floorId)){this.drawThumbnail(a.floorId,"ui",core.maps.load(a.maps,a.floorId).blocks,(2*b+1)*j-h/2,50,h,a.hero.loc);core.fillText("ui",core.formatDate(new Date(a.time)),(2*b+1)*j,65+h,"#FFFFFF","10px Verdana")}else{core.fillRect("ui",(2*b+1)*j-h/2,50,h,h,"#333333",2);core.fillText("ui","空",(2*b+1)*j,117,"#FFFFFF","bold 30px Verdana")}}else{core.fillText("ui",e+c,(2*b-5)*j,230,"#FFFFFF","bold 17px Verdana");core.strokeRect("ui",(2*b-5)*j-h/2,245,h,h,b==f?"#FFD700":"#FFFFFF",b==f?6:2);if(core.isset(a)&&core.isset(a.floorId)){this.drawThumbnail(a.floorId,"ui",core.maps.load(a.maps,a.floorId).blocks,(2*b-5)*j-h/2,245,h,a.hero.loc);core.fillText("ui",core.formatDate(new Date(a.time)),(2*b-5)*j,260+h,"#FFFFFF","10px Verdana")}else{core.fillRect("ui",(2*b-5)*j-h/2,245,h,h,"#333333",2);core.fillText("ui","空",(2*b-5)*j,245+70,"#FFFFFF","bold 30px Verdana")}}}this.drawPagination(g+1,30)};ui.prototype.drawThumbnail=function(h,g,f,w,z,v,n){core.clearMap(g,w,z,v,v);var k=core.floors[h].defaultGround||"ground";var d=core.material.icons.terrains[k];var e=core.material.images.terrains;var r=v/13;for(var o=0;o<13;o++){for(var p=0;p<13;p++){core.canvas[g].drawImage(e,0,d*32,32,32,w+o*r,z+p*r,r,r)}}if(core.isset(core.floors[h].png)){var s=core.floors[h].png;var t=v/416;if(typeof s=="string"){if(core.isset(core.material.images.pngs[s])){core.canvas.ui.drawImage(core.material.images.pngs[s],w,z,v,v)}}else{if(s instanceof Array){s.forEach(function(y){if(y.length!=3){return}var b=parseInt(y[0]),i=parseInt(y[1]),x=y[2];if(core.isset(b)&&core.isset(i)&&core.isset(core.material.images.pngs[x])){b*=32;i*=32;var j=core.material.images.pngs[x];core.canvas.ui.drawImage(j,w+b*t,z+i*t,Math.min(v-b*t,t*j.width),Math.min(v-i*t,t*j.height))}})}}}var q=core.maps.getMapArray(f);for(var a in f){var c=f[a];if(core.isset(c.event)&&!(core.isset(c.enable)&&!c.enable)){if(c.event.cls=="autotile"){core.drawAutotile(core.canvas.ui,q,c,r,w,z)}else{if(c.event.id!="none"){var d=core.material.icons[c.event.cls][c.event.id];var e=core.material.images[c.event.cls];core.canvas[g].drawImage(e,0,d*32,32,32,w+c.x*r,z+c.y*r,r,r)}}}}if(core.isset(n)){var m=core.material.icons.hero[n.direction];var l=core.material.icons.hero.height;var u=r*l/32;core.canvas[g].drawImage(core.material.images.hero,m.stop*32,m.loc*l,32,l,w+r*n.x,z+r*n.y+r-u,r,u)}};ui.prototype.drawKeyBoard=function(){core.lockControl();core.status.event.id="keyBoard";core.clearMap("ui",0,0,416,416);var c=16,g=48,f=416-2*c,b=416-2*g;var a=core.canvas.ui.createPattern(core.material.ground,"repeat");core.fillRect("ui",c,g,f,b,a);core.strokeRect("ui",c-1,g-1,f+1,b+1,"#FFFFFF",2);core.canvas.ui.textAlign="center";core.fillText("ui","虚拟键盘",208,g+35,"#FFD700","bold 22px Verdana");core.setFont("ui","17px Verdana");core.setFillStyle("ui","#FFFFFF");var e=128-9;var d=[["F1","F2","F3","F4","F5","F6","F7","F8","F9","10","11"],["1","2","3","4","5","6","7","8","9","0"],["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M"],["-","=","[","]","\\",";","'",",",".","/","`"],["ES","TA","CA","SH","CT","AL","SP","BS","EN","DE"]];d.forEach(function(j){for(var h=0;h<j.length;h++){core.fillText("ui",j[h],48+32*h,e)}e+=32});core.fillText("ui","返回游戏",416-80,e-3,"#FFFFFF","bold 15px Verdana")};ui.prototype.drawAbout=function(){if(!core.isPlaying()){core.status.event={id:null,data:null};core.dom.startPanel.style.display="none"}core.lockControl();core.status.event.id="about";core.clearMap("ui",0,0,416,416);var b=48,e=36,c=416-2*b,a=416-2*e;core.setAlpha("ui",0.85);core.fillRect("ui",b,e,c,a,"#000000");core.setAlpha("ui",1);core.strokeRect("ui",b-1,e-1,c+1,a+1,"#FFFFFF",2);var d=b+24;core.canvas.ui.textAlign="left";core.fillText("ui","HTML5 魔塔样板",d,e+35,"#FFD700","bold 22px Verdana");core.fillText("ui","版本： "+core.firstData.version,d,e+80,"#FFFFFF","bold 17px Verdana");core.fillText("ui","作者： 艾之葵",d,e+112);core.fillText("ui","HTML5魔塔交流群：539113091",d,e+112+32)};ui.prototype.drawHelp=function(){core.drawText(["\t[键盘快捷键列表][CTRL] 跳过对话\n[X] 打开/关闭怪物手册\n[G] 打开/关闭楼层传送器\n[A] 读取自动存档（回退）\n[S/D] 打开/关闭存/读档页面\n[K] 打开/关闭快捷商店选择列表\n[T] 打开/关闭工具栏\n[ESC] 打开/关闭系统菜单\n[E] 显示光标\n[H] 打开帮助页面\n[R] 回放\n[SPACE] 轻按（仅在轻按开关打开时有效）\n[1] 快捷使用破墙镐\n[2] 快捷使用炸弹/圣锤\n[3] 快捷使用中心对称飞行器","\t[鼠标操作]点状态栏中图标： 进行对应的操作\n点任意块： 寻路并移动\n点任意块并拖动： 指定寻路路线\n单击勇士： 转向\n双击勇士： 轻按（仅在轻按开关打开时有效）\n长按任意位置：打开虚拟键盘"])};