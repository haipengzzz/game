function events(){}events.prototype.init=function(){this.events={battle:function(c,b,a){b.battle(c.event.id,c.x,c.y);if(b.isset(a)){a()}},getItem:function(c,b,a){b.getItem(c.event.id,1,c.x,c.y);if(b.isset(a)){a()}},openDoor:function(c,b,a){b.openDoor(c.event.id,c.x,c.y,true,function(){if(b.isset(a)){a()}b.replay()})},changeFloor:function(c,b,a){var d={};if(b.isset(c.event.data.loc)){d={x:c.event.data.loc[0],y:c.event.data.loc[1]}}if(b.isset(c.event.data.direction)){d.direction=c.event.data.direction}b.changeFloor(c.event.data.floorId,c.event.data.stair,d,c.event.data.time,function(){if(b.isset(a)){a()}b.replay()})},passNet:function(c,b,a){b.events.passNet(c);if(b.isset(a)){a()}},changeLight:function(c,b,a){b.events.changeLight(c.x,c.y);if(b.isset(a)){a()}},ski:function(c,b,a){b.events.ski();if(b.isset(a)){a()}},pushBox:function(c,b,a){b.events.pushBox(c);if(b.isset(a)){a()}},action:function(c,b,a){b.events.doEvents(c.event.data,c.x,c.y);if(b.isset(a)){a()}}}};events.prototype.getEvents=function(a){if(!core.isset(a)){return this.events}return this.events[a]};main.instance.events=new events();events.prototype.startGame=function(a){if(core.status.isStarting){return}core.status.isStarting=true;core.hideStartAnimate(function(){core.drawText(core.clone(core.firstData.startText),function(){if(core.flags.showBattleAnimateConfirm){core.status.event.selection=core.flags.battleAnimate?0:1;core.ui.drawConfirmBox("你想开启战斗动画吗？\n之后可以在菜单栏中开启或关闭。\n（强烈建议新手开启此项）",function(){core.flags.battleAnimate=true;core.setLocalStorage("battleAnimate",true);core.startGame(a);core.events.setInitData(a)},function(){core.flags.battleAnimate=false;core.setLocalStorage("battleAnimate",false);core.startGame(a);core.events.setInitData(a)})}else{core.startGame(a);core.events.setInitData(a)}})})};events.prototype.setInitData=function(a){if(a=="Easy"){core.setFlag("hard",1)}if(a=="Normal"){core.setFlag("hard",2)}if(a=="Hard"){core.setFlag("hard",3)}this.afterLoadData()};events.prototype.win=function(a){core.ui.closePanel();var b=core.status.replay.replaying;core.stopReplay();core.waitHeroToStop(function(){core.removeGlobalAnimate(0,0,true);core.clearMap("all");core.drawText([core.status.hero.lv>=200?"\t[True End]你的攻防和分数是${status:hp}。":"\t[Normal End]你的攻防和分数是${status:hp}。\n（只有不小于200级才能达成True End）"],function(){core.events.gameOver(core.status.hero.lv>=200?"True End":"Normal End",b)})})};events.prototype.lose=function(a){core.ui.closePanel();var b=core.status.replay.replaying;core.stopReplay();core.waitHeroToStop(function(){core.drawText(["\t[结局1]你死了。\n如题。"],function(){core.events.gameOver(null,b)})})};events.prototype.gameOver=function(c,d){var b=function(){if(!core.isset(c)){core.restart();return}var e=function(g){if(g==null){g=""}var f=new FormData();f.append("type","score");f.append("name",core.firstData.name);f.append("version",core.firstData.version);f.append("platform",core.platform.isPC?"PC":core.platform.isAndroid?"Android":core.platform.isIOS?"iOS":"");f.append("hard",core.status.hard);f.append("username",g);f.append("ending",c);f.append("lv",core.status.hero.lv);f.append("hp",core.status.hero.hp);f.append("atk",core.status.hero.atk);f.append("def",core.status.hero.def);f.append("mdef",core.status.hero.mdef);f.append("money",core.status.hero.money);f.append("experience",core.status.hero.experience);f.append("steps",core.status.hero.steps);f.append("route",core.encodeRoute(core.status.route));var h=new XMLHttpRequest();h.open("POST","/games/upload.php");h.send(f);core.restart()};core.ui.drawConfirmBox("你想记录你的ID和成绩吗？",function(){e(prompt("请输入你的ID："))},function(){e("")});return};var a=function(){core.ui.closePanel();core.ui.drawConfirmBox("你想下载录像吗？",function(){var e={name:core.firstData.name,version:core.firstData.version,hard:core.status.hard,route:core.encodeRoute(core.status.route)};core.download(core.firstData.name+"_"+core.formatDate2(new Date())+".h5route",JSON.stringify(e));b()},function(){b()})};if(d){core.drawText("录像回放完毕！",function(){core.restart()})}else{a()}};events.prototype.afterChangeFloor=function(a){if(core.isset(core.status.event.id)){return}if(!core.hasFlag("visited_"+a)){this.doEvents(core.floors[a].firstArrive,null,null,function(){});core.setFlag("visited_"+a,true);return}};events.prototype.doEvents=function(b,c,d,a){if(!core.isset(b)){return}if(!(b instanceof Array)){b=[b]}core.waitHeroToStop(function(){core.lockControl();core.status.event={id:"action",data:{list:core.clone(b),x:c,y:d,callback:a}};core.events.doAction()})};events.prototype.doAction=function(){core.status.boxAnimateObjs=[];core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);if(core.status.event.data.list.length==0){if(core.isset(core.status.event.data.callback)){core.status.event.data.callback()}core.ui.closePanel();core.replay();return}var data=core.status.event.data.list.shift();core.status.event.data.current=data;var x=core.status.event.data.x,y=core.status.event.data.y;if(typeof data=="string"){core.status.event.data.type="text";if(core.status.replay.replaying){core.events.doAction()}else{core.ui.drawTextBox(data)}return}core.status.event.data.type=data.type;switch(data.type){case"text":if(core.status.replay.replaying){core.events.doAction()}else{core.ui.drawTextBox(data.data)}break;case"setText":if(data.position=="up"||data.position=="down"||data.position=="center"){core.status.textAttribute.position=data.position}["background","title","text"].forEach(function(t){if(core.isset(data[t])&&(data[t] instanceof Array)&&data[t].length>=3){if(data[t].length==3){data[t].push(1)}core.status.textAttribute[t]=data[t]}});core.events.doAction();break;case"tip":core.drawTip(core.replaceText(data.text));core.events.doAction();break;case"show":if(typeof data.loc[0]=="number"&&typeof data.loc[1]=="number"){data.loc=[data.loc]}if(core.isset(data.time)&&data.time>0&&(!core.isset(data.floorId)||data.floorId==core.status.floorId)){core.animateBlock(data.loc,"show",data.time,function(){data.loc.forEach(function(t){core.showBlock(t[0],t[1],data.floorId)});core.events.doAction()})}else{data.loc.forEach(function(t){core.showBlock(t[0],t[1],data.floorId)});this.doAction()}break;case"hide":if(!core.isset(data.loc)){data.loc=[x,y]}if(typeof data.loc[0]=="number"&&typeof data.loc[1]=="number"){data.loc=[data.loc]}data.loc.forEach(function(t){core.removeBlock(t[0],t[1],data.floorId)});if(core.isset(data.time)&&data.time>0&&(!core.isset(data.floorId)||data.floorId==core.status.floorId)){core.animateBlock(data.loc,"hide",data.time,function(){core.events.doAction()})}else{this.doAction()}break;case"setBlock":if(core.isset(data.loc)){x=data.loc[0];y=data.loc[1]}var floorId=data.floorId||core.status.floorId;var originBlock=core.getBlock(x,y,floorId,false);var block=core.maps.getBlock(x,y,data.number);core.maps.addInfo(block);core.maps.addEvent(block,x,y,core.floors[floorId].events[x+","+y]);core.maps.addChangeFloor(block,x,y,core.floors[floorId].changeFloor[x+","+y]);if(core.isset(block.event)){if(originBlock==null){core.status.maps[floorId].blocks.push(block)}else{originBlock.block.id=data.number;originBlock.block.event=block.event}if(floorId==core.status.floorId){core.drawMap(floorId);core.drawHero(core.getHeroLoc("direction"),core.getHeroLoc("x"),core.getHeroLoc("y"),"stop");core.updateStatusBar()}}this.doAction();break;case"animate":if(core.isset(data.loc)){if(data.loc=="hero"){x=core.getHeroLoc("x");y=core.getHeroLoc("y")}else{if(data.loc instanceof Array){x=data.loc[0];y=data.loc[1]}}}core.drawAnimate(data.name,x,y,function(){core.events.doAction()});break;case"move":if(core.isset(data.loc)){x=data.loc[0];y=data.loc[1]}core.moveBlock(x,y,data.steps,data.time,data.immediateHide,function(){core.events.doAction()});break;case"moveHero":core.eventMoveHero(data.steps,data.time,function(){core.events.doAction()});break;case"changeFloor":var heroLoc={x:data.loc[0],y:data.loc[1]};if(core.isset(data.direction)){heroLoc.direction=data.direction}core.changeFloor(data.floorId||core.status.floorId,null,heroLoc,data.time,function(){core.lockControl();core.events.doAction()});break;case"changePos":core.clearMap("hero",0,0,416,416);if(core.isset(data.loc)){core.setHeroLoc("x",data.loc[0]);core.setHeroLoc("y",data.loc[1])}if(core.isset(data.direction)){core.setHeroLoc("direction",data.direction)}core.drawHero(core.getHeroLoc("direction"),core.getHeroLoc("x"),core.getHeroLoc("y"),"stop");this.doAction();break;case"showImage":if(core.isset(data.loc)&&core.isset(core.material.images.pngs[data.name])){core.canvas.animate.drawImage(core.material.images.pngs[data.name],data.loc[0],data.loc[1])}else{core.clearMap("animate",0,0,416,416)}this.doAction();break;case"setFg":core.setFg(data.color,data.time,function(){core.events.doAction()});break;case"setWeather":core.setWeather(data.name,data.level);this.doAction();break;case"openDoor":var floorId=data.floorId||core.status.floorId;var block=core.getBlock(data.loc[0],data.loc[1],floorId);if(block!=null){if(floorId==core.status.floorId){core.openDoor(block.block.event.id,block.block.x,block.block.y,false,function(){core.events.doAction()})}else{core.removeBlock(block.block.x,block.block.y,floorId);this.doAction()}break}this.doAction();break;case"openShop":if(core.status.replay.replaying){core.status.shops[data.id].visited=true;core.status.event.data.list=[];this.doAction()}else{core.events.openShop(data.id)}break;case"disableShop":core.events.disableQuickShop(data.id);this.doAction();break;case"battle":core.battle(data.id,null,null,true,function(){core.events.doAction()});break;case"trigger":var toX=data.loc[0],toY=data.loc[1];var block=core.getBlock(toX,toY);if(block!=null){block=block.block;if(core.isset(block.event)&&block.event.trigger=="action"){core.status.event.data.list=core.clone(block.event.data);core.status.event.data.x=block.x;core.status.event.data.y=block.y}}this.doAction();break;case"playSound":core.playSound(data.name);this.doAction();break;case"playBgm":core.playBgm(data.name);this.doAction();break;case"pauseBgm":core.pauseBgm();this.doAction();break;case"resumeBgm":core.resumeBgm();this.doAction();break;case"setValue":try{var value=core.calValue(data.value);if(data.name.indexOf("status:")==0){value=parseInt(value);core.setStatus(data.name.substring(7),value)}if(data.name.indexOf("item:")==0){value=parseInt(value);var itemId=data.name.substring(5);if(value>core.itemCount(itemId)){core.getItem(itemId,value-core.itemCount(itemId))}else{core.setItem(itemId,value)}}if(data.name.indexOf("flag:")==0){core.setFlag(data.name.substring(5),value)}}catch(e){console.log(e)}if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose("damage")}else{core.updateStatusBar();this.doAction()}break;case"input":var value;if(core.status.replay.replaying){var action=core.status.replay.toReplay.shift();if(action.indexOf("input:")==0){value=parseInt(action.substring(6))}else{core.stopReplay();core.drawTip("录像文件出错");return}}else{value=prompt(core.replaceText(data.text))}value=Math.abs(parseInt(value)||0);core.status.route.push("input:"+value);core.setFlag("input",value);this.doAction();break;case"if":if(core.calValue(data.condition)){core.events.insertAction(data["true"])}else{core.events.insertAction(data["false"])}this.doAction();break;case"choices":if(core.status.replay.replaying){if(core.status.replay.toReplay.length==0){core.status.replay.replaying=false;core.drawTip("录像回放完毕")}else{var action=core.status.replay.toReplay.shift(),index;if(action.indexOf("choices:")==0&&((index=parseInt(action.substring(8)))>=0)&&index<data.choices.length){core.status.event.selection=index;setTimeout(function(){core.status.route.push("choices:"+index);core.events.insertAction(data.choices[index].action);core.events.doAction()},750)}else{core.stopReplay();core.drawTip("录像文件出错")}}}core.ui.drawChoices(data.text,data.choices);break;case"win":core.events.win(data.reason,function(){core.events.doAction()});break;case"lose":core.events.lose(data.reason,function(){core.events.doAction()});break;case"function":var func=data["function"];if(core.isset(func)){if((typeof func=="string")&&func.indexOf("function")==0){eval("("+func+")()")}else{if(func instanceof Function){func()}}}this.doAction();break;case"update":core.updateStatusBar();this.doAction();break;case"sleep":setTimeout(function(){core.events.doAction()},data.time);break;case"revisit":var block=core.getBlock(x,y);if(block!=null){block=block.block;if(core.isset(block.event)&&block.event.trigger=="action"){core.status.event.data.list=core.clone(block.event.data)}}this.doAction();break;case"exit":core.status.event.data.list=[];core.events.doAction();break;default:core.status.event.data.type="text";core.ui.drawTextBox("\t[警告]出错啦！\n"+data.type+" 事件不被支持...")}return};events.prototype.insertAction=function(a,c,d,b){if(core.status.event.id==null){this.doEvents(a,c,d,b)}else{core.unshift(core.status.event.data.list,a);if(core.isset(c)){core.status.event.data.x=c}if(core.isset(d)){core.status.event.data.y=d}if(core.isset(b)){core.status.event.data.callback=b}}};events.prototype.openShop=function(shopId,needVisited){var shop=core.status.shops[shopId];shop.times=shop.times||0;shop.visited=shop.visited||false;if(needVisited&&!shop.visited){if(shop.times==0){core.drawTip("该商店尚未开启")}else{core.drawTip("该商店已失效")}return}shop.visited=true;var selection=core.status.event.selection;var actions=[];if(core.isset(core.status.event.data)&&core.isset(core.status.event.data.actions)){actions=core.status.event.data.actions}var fromList;if(core.isset(core.status.event.data)&&core.isset(core.status.event.data.fromList)){fromList=core.status.event.data.fromList}core.ui.closePanel();core.lockControl();core.status.event.id="shop";core.status.event.data={id:shopId,shop:shop,actions:actions,fromList:fromList};core.status.event.selection=selection;var content="\t["+shop.name+","+shop.icon+"]";var times=shop.times,need=eval(shop.need);content=content+shop.text.replace(/\${([^}]+)}/g,function(word,value){return eval(value)});var use=shop.use=="experience"?"经验":"金币";var choices=[];for(var i=0;i<shop.choices.length;i++){var choice=shop.choices[i];var text=choice.text;if(core.isset(choice.need)){text+="（"+eval(choice.need)+use+"）"}choices.push(text)}choices.push("离开");core.ui.drawChoices(content,choices)};events.prototype.disableQuickShop=function(a){core.status.shops[a].visited=false};events.prototype.canUseQuickShop=function(a){if(core.isset(core.floors[core.status.floorId].canUseQuickShop)&&!core.floors[core.status.floorId].canUseQuickShop){return"当前不能使用快捷商店。"}return null};events.prototype.checkLvUp=function(){if(!core.flags.enableLevelUp||core.status.hero.lv>=core.firstData.levelUp.length){return}var need=core.firstData.levelUp[core.status.hero.lv].need;if(!core.isset(need)){return}if(core.status.hero.experience>=need){core.status.hero.lv++;var effect=core.firstData.levelUp[core.status.hero.lv-1].effect;if(typeof effect=="string"){if(effect.indexOf("function")==0){eval("("+effect+")()")}else{effect.split(";").forEach(function(t){core.doEffect(t)})}}else{if(effect instanceof Function){effect()}}this.checkLvUp()}};events.prototype.useItem=function(b){core.ui.closePanel();if(b=="book"){core.openBook(false);return}if(b=="fly"){core.useFly(false);return}if(b=="centerFly"){core.status.usingCenterFly=true;var a="rgba(255,0,0,0.5)";if(core.canUseItem("centerFly")){a="rgba(0,255,0,0.5)"}core.fillRect("ui",(12-core.getHeroLoc("x"))*32,(12-core.getHeroLoc("y"))*32,32,32,a);core.drawTip("请确认当前中心对称飞行器的位置");return}if(core.canUseItem(b)){core.useItem(b)}else{core.drawTip("当前无法使用"+core.material.items[b].name)}};events.prototype.addPoint=function(a){var b=a.point;if(!core.isset(b)||b<=0){return[]}return[{type:"choices",choices:[{text:"攻击+"+(1*b),action:[{type:"setValue",name:"status:atk",value:"status:atk+"+(1*b)}]},{text:"防御+"+(2*b),action:[{type:"setValue",name:"status:def",value:"status:def+"+(2*b)}]},{text:"生命+"+(200*b),action:[{type:"setValue",name:"status:hp",value:"status:hp+"+(200*b)}]},]}]};events.prototype.afterBattle=function(c,h,i,a){var b=core.material.enemys[c];var f=b.special;if(core.enemys.hasSpecial(f,12)&&!core.hasFlag("poison")){core.setFlag("poison",true)}if(core.enemys.hasSpecial(f,13)&&!core.hasFlag("weak")){core.setFlag("weak",true);core.status.hero.atk-=core.values.weakValue;core.status.hero.def-=core.values.weakValue}if(core.enemys.hasSpecial(f,14)&&!core.hasFlag("curse")){core.setFlag("curse",true)}if(core.flags.hatredDecrease&&core.enemys.hasSpecial(f,17)){core.setFlag("hatred",parseInt(core.getFlag("hatred",0)/2))}if(core.enemys.hasSpecial(f,19)){core.status.hero.hp=1}if(core.enemys.hasSpecial(f,21)){core.status.hero.atk-=(b.atkValue||0);core.status.hero.def-=(b.defValue||0);if(core.status.hero.atk<0){core.status.hero.atk=0}if(core.status.hero.def<0){core.status.hero.def=0}}core.setFlag("hatred",core.getFlag("hatred",0)+core.values.hatred);core.updateStatusBar();var g=[];if(!core.enemys.hasSpecial(f,18)&&core.isset(h)&&core.isset(i)){var d=core.floors[core.status.floorId].afterBattle[h+","+i];if(core.isset(d)){core.unshift(g,d)}}var e=core.material.enemys[c].point;if(core.isset(e)&&e>0){core.unshift(g,core.events.addPoint(core.material.enemys[c]))}if(g.length>0){this.insertAction(g,h,i)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}if(core.isset(a)){a()}};events.prototype.afterOpenDoor=function(b,e,f,a){var d=[];if(core.isset(e)&&core.isset(f)){var c=core.floors[core.status.floorId].afterOpenDoor[e+","+f];if(core.isset(c)){core.unshift(d,c)}}if(d.length>0){this.insertAction(d,e,f)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}if(core.isset(a)){a()}};events.prototype.passNet=function(a){if(core.hasItem("shoes")){return}if(a.event.id=="lavaNet"){core.status.hero.hp-=core.values.lavaDamage;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose("lava");return}core.drawTip("经过血网，生命-"+core.values.lavaDamage)}if(a.event.id=="poisonNet"){if(core.hasFlag("poison")){return}core.setFlag("poison",true)}if(a.event.id=="weakNet"){if(core.hasFlag("weak")){return}core.setFlag("weak",true);core.status.hero.atk-=core.values.weakValue;core.status.hero.def-=core.values.weakValue}if(a.event.id=="curseNet"){if(core.hasFlag("curse")){return}core.setFlag("curse",true)}core.updateStatusBar()};events.prototype.changeLight=function(d,e){var a=core.getBlock(d,e);if(a==null){return}var c=a.index;a=a.block;if(a.event.id!="light"){return}a.id=166;a.event={cls:"terrains",id:"darkLight",noPass:true};core.canvas.event.clearRect(d*32,e*32,32,32);var b=core.material.icons[a.event.cls][a.event.id];core.canvas.event.drawImage(core.material.images[a.event.cls],0,b*32,32,32,a.x*32,a.y*32,32,32);this.afterChangeLight(d,e)};events.prototype.afterChangeLight=function(a,b){};events.prototype.ski=function(a){if(!core.isset(a)){a=core.status.automaticRoute.lastDirection||core.getHeroLoc("direction")}if(core.status.event.id!="ski"){core.waitHeroToStop(function(){core.status.event.id="ski";core.events.ski(a)})}else{core.moveHero(a,function(){if(core.status.event.id=="ski"){core.status.event.id=null;core.unLockControl();core.replay()}})}};events.prototype.pushBox=function(c){if(c.event.id!="box"&&c.event.id!="boxed"){return}var g={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}};var d=core.getHeroLoc("direction"),e=c.x+g[d].x,f=c.y+g[d].y;if(e<0||e>12||f<0||f>12){return}var a=core.getBlock(e,f,null,false);if(a!=null&&!(core.isset(a.block.event)&&a.block.event.id=="flower")){return}var b;if(a==null){core.status.thisMap.blocks.push(core.maps.getBlock(e,f,169));b=core.material.icons.terrains.box}else{a.block.id=170;a.block.event=core.maps.getBlock(null,null,170).event;b=core.material.icons.terrains.boxed}core.canvas.event.clearRect(e*32,f*32,32,32);core.canvas.event.drawImage(core.material.images.terrains,0,b*32,32,32,e*32,f*32,32,32);if(c.event.id=="box"){core.removeBlock(c.x,c.y)}else{c.id=168;c.event=core.maps.getBlock(null,null,168).event;core.canvas.event.clearRect(c.x*32,c.y*32,32,32);core.canvas.event.drawImage(core.material.images.terrains,0,core.material.icons.terrains.flower*32,32,32,c.x*32,c.y*32,32,32)}core.updateStatusBar();core.lockControl();core.eventMoveHero([d],null,function(){core.unLockControl();core.events.afterPushBox();core.replay()})};events.prototype.afterPushBox=function(){var a=function(){for(var c=0;c<core.status.thisMap.blocks.length;c++){var b=core.status.thisMap.blocks[c];if(core.isset(b.event)&&b.event.id=="box"){return false}}return true};if(a()){}};events.prototype.afterUseBomb=function(){};events.prototype.beforeSaveData=function(a){};events.prototype.afterLoadData=function(a){core.enemys.update()};events.prototype.longClick=function(){core.waitHeroToStop(function(){core.ui.drawKeyBoard()})};events.prototype.keyDownCtrl=function(){if(core.status.event.id=="text"){core.drawText();return}if(core.status.event.id=="action"&&core.status.event.data.type=="text"){this.doAction();return}};events.prototype.clickConfirmBox=function(a,b){if((a==4||a==5)&&b==7&&core.isset(core.status.event.data.yes)){core.status.event.data.yes()}if((a==7||a==8)&&b==7&&core.isset(core.status.event.data.no)){core.status.event.data.no()}};events.prototype.keyUpConfirmBox=function(a){if(a==37){core.status.event.selection=0;core.ui.drawConfirmBox(core.status.event.ui,core.status.event.data.yes,core.status.event.data.no)}if(a==39){core.status.event.selection=1;core.ui.drawConfirmBox(core.status.event.ui,core.status.event.data.yes,core.status.event.data.no)}if(a==13||a==32||a==67){if(core.status.event.selection==0&&core.isset(core.status.event.data.yes)){core.status.event.selection=null;core.status.event.data.yes()}if(core.status.event.selection==1&&core.isset(core.status.event.data.no)){core.status.event.selection=null;core.status.event.data.no()}}};events.prototype.clickAction=function(d,e){if(core.status.event.data.type=="text"){this.doAction();return}if(core.status.event.data.type=="choices"){var b=core.status.event.data.current;var a=b.choices;if(a.length==0){return}if(d>=5&&d<=7){var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){core.status.route.push("choices:"+(e-c));this.insertAction(a[e-c].action);this.doAction()}}}};events.prototype.keyDownAction=function(c){if(core.status.event.data.type=="choices"){var b=core.status.event.data.current;var a=b.choices;if(a.length>0){if(c==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(c==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}}}};events.prototype.keyUpAction=function(c){if(core.status.event.data.type=="text"&&(c==13||c==32||c==67)){this.doAction();return}if(core.status.event.data.type=="choices"){var b=core.status.event.data.current;var a=b.choices;if(a.length>0){if(c==13||c==32||c==67){core.status.route.push("choices:"+core.status.event.selection);this.insertAction(a[core.status.event.selection].action);this.doAction()}}}};events.prototype.clickBook=function(d,e){if((d==3||d==4)&&e==12){core.ui.drawBook(core.status.event.data-6);return}if((d==8||d==9)&&e==12){core.ui.drawBook(core.status.event.data+6);return}if(d>=10&&d<=12&&e==12){if(core.status.event.selection==null){core.ui.closePanel()}else{core.status.boxAnimateObjs=[];core.ui.drawMaps(core.status.event.selection)}return}var a=core.status.event.data;if(core.isset(a)&&e<12){var c=parseInt(a/6);var b=6*c+parseInt(e/2);core.ui.drawBook(b);core.ui.drawBookDetail(b)}return};events.prototype.keyDownBook=function(a){if(a==37){core.ui.drawBook(core.status.event.data-6)}if(a==38){core.ui.drawBook(core.status.event.data-1)}if(a==39){core.ui.drawBook(core.status.event.data+6)}if(a==40){core.ui.drawBook(core.status.event.data+1)}if(a==33){core.ui.drawBook(core.status.event.data-6)}if(a==34){core.ui.drawBook(core.status.event.data+6)}return};events.prototype.keyUpBook=function(b){if(b==27||b==88){if(core.status.event.selection==null){core.ui.closePanel()}else{core.status.boxAnimateObjs=[];core.ui.drawMaps(core.status.event.selection)}return}if(b==13||b==32||b==67){var a=core.status.event.data;if(core.isset(a)){this.clickBook(6,2*(a%6))}return}};events.prototype.clickBookDetail=function(){core.clearMap("data",0,0,416,416);core.status.event.id="book"};events.prototype.clickFly=function(e,f){if((e==10||e==11)&&f==9){core.ui.drawFly(core.status.event.data-1)}if((e==10||e==11)&&f==5){core.ui.drawFly(core.status.event.data+1)}if(e>=5&&e<=7&&f==12){core.ui.closePanel()}if(e>=0&&e<=9&&f>=3&&f<=11){var b=core.status.hero.flyRange.indexOf(core.status.floorId);var c=core.status.event.data<b?"upFloor":"downFloor";var a=core.status.event.data;var d=core.status.hero.flyRange[a];core.status.route.push("fly:"+d);core.ui.closePanel();core.changeFloor(d,c)}return};events.prototype.keyDownFly=function(a){if(a==37||a==38){core.ui.drawFly(core.status.event.data+1)}else{if(a==39||a==40){core.ui.drawFly(core.status.event.data-1)}}return};events.prototype.keyUpFly=function(a){if(a==71||a==27||a==88){core.ui.closePanel()}if(a==13||a==32||a==67){this.clickFly(5,5)}return};events.prototype.clickViewMaps=function(a,b){if(b<=4){core.ui.drawMaps(core.status.event.data+1)}else{if(b>=8){core.ui.drawMaps(core.status.event.data-1)}else{core.clearMap("data",0,0,416,416);core.setOpacity("data",1);core.ui.closePanel()}}};events.prototype.keyDownViewMaps=function(a){if(a==37||a==38||a==33){core.ui.drawMaps(core.status.event.data+1)}else{if(a==39||a==40||a==34){core.ui.drawMaps(core.status.event.data-1)}}return};events.prototype.keyUpViewMaps=function(a){if(a==27||a==13||a==32||a==67){core.clearMap("data",0,0,416,416);core.setOpacity("data",1);core.ui.closePanel()}if(a==88){core.openBook(false)}return};events.prototype.clickShop=function(x,y){var shop=core.status.event.data.shop;var choices=shop.choices;if(x>=5&&x<=7){var topIndex=6-parseInt(choices.length/2);if(y>=topIndex&&y<topIndex+choices.length){core.status.event.selection=y-topIndex;var money=core.getStatus("money"),experience=core.getStatus("experience");var times=shop.times,need=eval(shop.need);var use=shop.use;var use_text=use=="money"?"金币":"经验";var choice=choices[y-topIndex];if(core.isset(choice.need)){need=eval(choice.need)}if(need>eval(use)){core.drawTip("你的"+use_text+"不足");return false}core.status.event.data.actions.push(y-topIndex);eval(use+"-="+need);core.setStatus("money",money);core.setStatus("experience",experience);choice.effect.split(";").forEach(function(t){core.doEffect(t)});core.updateStatusBar();shop.times++;this.openShop(core.status.event.data.id)}else{if(y==topIndex+choices.length){if(core.status.event.data.actions.length>0){core.status.route.push("shop:"+core.status.event.data.id+":"+core.status.event.data.actions.join(""))}core.status.event.data.actions=[];core.status.boxAnimateObjs=[];if(core.status.event.data.fromList){core.ui.drawQuickShop()}else{core.ui.closePanel()}}else{return false}}}return true};events.prototype.keyDownShop=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};events.prototype.keyUpShop=function(b){if(b==27||b==88){if(core.status.event.data.actions.length>0){core.status.route.push("shop:"+core.status.event.data.id+":"+core.status.event.data.actions.join(""))}core.status.event.data.actions=[];core.status.boxAnimateObjs=[];if(core.status.event.data.fromList){core.ui.drawQuickShop()}else{core.ui.closePanel()}return}var c=core.status.event.data.shop;var a=c.choices;if(b==13||b==32||b==67){var d=6-parseInt(a.length/2);this.clickShop(6,d+core.status.event.selection)}return};events.prototype.clickQuickShop=function(e,f){var c=core.status.shops,a=Object.keys(c);if(e>=5&&e<=7){var d=6-parseInt(a.length/2);if(f>=d&&f<d+a.length){var b=core.events.canUseQuickShop(a[f-d]);if(core.isset(b)){core.drawText(b);return}this.openShop(a[f-d],true);if(core.status.event.id=="shop"){core.status.event.data.fromList=true}}else{if(f==d+a.length){core.ui.closePanel()}}}};events.prototype.keyDownQuickShop=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};events.prototype.keyUpQuickShop=function(a){if(a==27||a==75||a==88){core.ui.closePanel();return}var c=core.status.shops,b=Object.keys(c);if(a==13||a==32||a==67){var d=6-parseInt(b.length/2);this.clickQuickShop(6,d+core.status.event.selection)}return};events.prototype.clickToolbox=function(b,c){if(b>=10&&b<=12&&c==12){core.ui.closePanel();return}if(b>=10&&b<=12&&c<=1){if(!core.isset(core.status.event.data)){return}if(!core.flags.enableDeleteItem){core.drawTip("不支持删除道具！");return}core.removeItem(core.status.event.data);core.status.event.data=null;core.ui.drawToolbox();return}var a=0;if(c==4||c==5||c==9||c==10){a=parseInt(b/2)}else{a=6+parseInt(b/2)}if(c>=9){a+=100}this.clickToolboxIndex(a)};events.prototype.clickToolboxIndex=function(b){var d=null;var a=b;if(a<100){d=Object.keys(core.status.hero.items.tools).sort()}else{a-=100;d=Object.keys(core.status.hero.items.constants).sort()}if(d==null){return}if(a>=d.length){return}var c=d[a];if(c==core.status.event.data){core.events.useItem(c)}else{core.ui.drawToolbox(b)}};events.prototype.keyDownToolbox=function(c){if(!core.isset(core.status.event.data)){return}var d=Object.keys(core.status.hero.items.tools).sort();var a=Object.keys(core.status.hero.items.constants).sort();var b=core.status.event.selection;if(c==37){if((b>0&&b<100)||b>100){this.clickToolboxIndex(b-1);return}if(b==100&&d.length>0){this.clickToolboxIndex(d.length-1);return}}if(c==38){if((b>5&&b<100)||b>105){this.clickToolboxIndex(b-6);return}if(b>=100&&b<=105){if(d.length>6){this.clickToolboxIndex(Math.min(d.length-1,b-100+6))}else{if(d.length>0){this.clickToolboxIndex(Math.min(d.length-1,b-100))}}return}}if(c==39){if((b<d.length-1)||(b>=100&&b<a.length+100)){this.clickToolboxIndex(b+1);return}if(b==d.length-1&&a.length>0){this.clickToolboxIndex(100);return}}if(c==40){if(b<=5){if(d.length>6){this.clickToolboxIndex(Math.min(d.length-1,b+6))}else{if(a.length>0){this.clickToolboxIndex(100+Math.min(a.length-1,b))}}return}if(b>5&&b<100&&a.length>0){this.clickToolboxIndex(100+Math.min(a.length-1,b-6));return}if(b>=100&&b<=105&&a.length>6){this.clickToolboxIndex(Math.min(100+a.length-1,b+6));return}}};events.prototype.keyUpToolbox=function(a){if(a==84||a==27||a==88){core.ui.closePanel();return}if(!core.isset(core.status.event.data)){return}if(a==13||a==32||a==67){this.clickToolboxIndex(core.status.event.selection);return}if(a==46){if(!core.isset(core.status.event.data)){return}if(!core.flags.enableDeleteItem){core.drawTip("不支持删除道具！");return}core.removeItem(core.status.event.data);core.status.event.data=null;core.ui.drawToolbox();return}};events.prototype.clickSL=function(d,e){var a=core.status.event.data;var c=parseInt(a/10),b=a%10;if((d==3||d==4)&&e==12){core.ui.drawSLPanel(10*(c-1)+b)}if((d==8||d==9)&&e==12){core.ui.drawSLPanel(10*(c+1)+b)}if(d>=10&&d<=12&&e==12){core.ui.closePanel();if(!core.isPlaying()){core.showStartAnimate()}return}var a=6*c+1;if(e>=1&&e<=4){if(d>=1&&d<=3){core.doSL("autoSave",core.status.event.id)}if(d>=5&&d<=7){core.doSL(5*c+1,core.status.event.id)}if(d>=9&&d<=11){core.doSL(5*c+2,core.status.event.id)}}if(e>=7&&e<=10){if(d>=1&&d<=3){core.doSL(5*c+3,core.status.event.id)}if(d>=5&&d<=7){core.doSL(5*c+4,core.status.event.id)}if(d>=9&&d<=11){core.doSL(5*c+5,core.status.event.id)}}};events.prototype.keyDownSL=function(b){var a=core.status.event.data;var d=parseInt(a/10),c=a%10;if(b==37){if(c==0){core.ui.drawSLPanel(10*(d-1)+5)}else{core.ui.drawSLPanel(a-1)}return}if(b==38){if(c<3){core.ui.drawSLPanel(10*(d-1)+c+3)}else{core.ui.drawSLPanel(a-3)}return}if(b==39){if(c==5){core.ui.drawSLPanel(10*(d+1)+1)}else{core.ui.drawSLPanel(a+1)}return}if(b==40){if(c>=3){core.ui.drawSLPanel(10*(d+1)+c-3)}else{core.ui.drawSLPanel(a+3)}return}if(b==33){core.ui.drawSLPanel(10*(d-1)+c);return}if(b==34){core.ui.drawSLPanel(10*(d+1)+c);return}};events.prototype.keyUpSL=function(b){var a=core.status.event.data;var d=parseInt(a/10),c=a%10;if(b==27||b==88||(core.status.event.id=="save"&&b==83)||(core.status.event.id=="load"&&b==68)){core.ui.closePanel();if(!core.isPlaying()){core.showStartAnimate()}return}if(b==13||b==32||b==67){if(c==0){core.doSL("autoSave",core.status.event.id)}else{core.doSL(5*d+c,core.status.event.id)}return}};events.prototype.clickSwitchs=function(d,e){if(d<5||d>7){return}var a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){var b=e-c;switch(b){case 0:core.musicStatus.bgmStatus=!core.musicStatus.bgmStatus;if(core.musicStatus.bgmStatus){core.resumeBgm()}else{core.pauseBgm()}core.setLocalStorage("bgmStatus",core.musicStatus.bgmStatus);core.ui.drawSwitchs();break;case 1:core.musicStatus.soundStatus=!core.musicStatus.soundStatus;core.setLocalStorage("soundStatus",core.musicStatus.soundStatus);core.ui.drawSwitchs();break;case 2:if(!core.flags.canOpenBattleAnimate){core.drawTip("本塔不能开启战斗动画！")}else{core.flags.battleAnimate=!core.flags.battleAnimate;core.setLocalStorage("battleAnimate",core.flags.battleAnimate);core.ui.drawSwitchs()}break;case 3:core.flags.displayEnemyDamage=!core.flags.displayEnemyDamage;core.updateFg();core.setLocalStorage("enemyDamage",core.flags.displayEnemyDamage);core.ui.drawSwitchs();break;case 4:core.flags.displayExtraDamage=!core.flags.displayExtraDamage;core.updateFg();core.setLocalStorage("extraDamage",core.flags.displayExtraDamage);core.ui.drawSwitchs();break;case 5:window.open(core.firstData.name+".zip","_blank");break;case 6:core.status.event.selection=0;core.ui.drawSettings();break}}};events.prototype.keyDownSwitchs=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};events.prototype.keyUpSwitchs=function(b){if(b==27||b==88){core.status.event.selection=0;core.ui.drawSettings();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickSwitchs(6,c+core.status.event.selection)}};events.prototype.clickSettings=function(e,g){if(e<5||e>7){return}var a=core.status.event.ui.choices;var d=6-parseInt((a.length-1)/2);if(g>=d&&g<d+a.length){var c=g-d;switch(c){case 0:core.status.event.selection=0;core.ui.drawSwitchs();break;case 1:core.status.event.selection=0;core.ui.drawQuickShop();break;case 2:if(!core.flags.enableViewMaps){core.drawTip("本塔不允许浏览地图！")}else{core.drawText("\t[系统提示]即将进入浏览地图模式。\n\n点击地图上半部分，或按[↑]键可查看前一张地图\n点击地图下半部分，或按[↓]键可查看后一张地图\n点击地图中间，或按[ESC]键可离开浏览地图模式\n此模式下可以打开怪物手册以查看某层楼的怪物属性",function(){core.ui.drawMaps(core.floorIds.indexOf(core.status.floorId))})}break;case 3:core.status.event.selection=0;core.ui.drawSyncSave();break;case 4:core.status.event.selection=1;core.ui.drawConfirmBox("你确定要重新开始吗？",function(){core.ui.closePanel();core.restart()},function(){core.status.event.selection=3;core.ui.drawSettings()});break;case 5:core.ui.drawWaiting("正在拉取统计信息，请稍后...");var b=new FormData();b.append("type","statistics");b.append("name",core.firstData.name);b.append("version",core.firstData.version);var f=new XMLHttpRequest();f.open("POST","/games/upload.php");f.onload=function(h){if(f.status==200){var i=JSON.parse(f.response);if(i.code<0){core.drawText("出错啦！\n无法拉取统计信息。\n错误原因："+i.msg)}else{var j="\t[本塔统计信息]";var k=false;i.data.forEach(function(l){if(k){j+="\n\n"}k=true;if(l.hard!=""){j+=l.hard+"难度： "}j+="已有"+l.people+"人次游戏，"+l.score+"人次通关。";l.info.forEach(function(m){if(m.ending!=""){j+="\n"+m.ending+"： 已有"+m.score+"人次通关。"}if(core.isset(m.max)&&m.max>0){j+="\n当前MAX为"+m.max+"，最早由 "+(m.username||"匿名")+" 于"+core.formatDate(new Date(1000*m.timestamp))+"打出。"}})});core.drawText(j)}}else{core.drawText("出错啦！\n无法拉取统计信息。\n错误原因：HTTP "+f.status)}};f.ontimeout=function(){core.drawText("出错啦！\n无法拉取统计信息。\n错误原因：Timeout")};f.onerror=function(){core.drawText("出错啦！\n无法拉取统计信息。\n错误原因：XHR Error")};f.send(b);break;case 6:core.ui.drawHelp();break;case 7:core.ui.drawAbout();break;case 8:core.ui.closePanel();break}}return};events.prototype.keyDownSettings=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};events.prototype.keyUpSettings=function(b){if(b==27||b==88){core.ui.closePanel();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickSettings(6,c+core.status.event.selection)}};events.prototype.clickSyncSave=function(d,e){if(d<5||d>7){return}var a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){var b=e-c;switch(b){case 0:core.status.event.selection=0;core.ui.drawSyncSelect();break;case 1:core.syncLoad();break;case 2:core.status.event.selection=0;core.ui.drawLocalSaveSelect();break;case 3:core.readFile(function(j){if(j.name!=core.firstData.name){alert("存档和游戏不一致！");return}if(j.version!=core.firstData.version){alert("游戏版本不一致！");return}if(!core.isset(j.data)){alert("无效的存档！");return}var f=j.data;if(f instanceof Array){core.ui.drawConfirmBox("所有本地存档都将被覆盖，确认？",function(){for(var k=1;k<=150;k++){if(k<=f.length){core.setLocalStorage("save"+k,f[k-1])}else{core.removeLocalStorage("save"+k)}}core.drawText("读取成功！\n你的本地所有存档均已被覆盖。")},function(){core.status.event.selection=0;core.ui.drawSyncSave()})}else{var h=150;for(var g=150;g>=1;g--){if(core.getLocalStorage("save"+g,null)==null){h=g}else{break}}core.setLocalStorage("save"+h,f);core.drawText("同步成功！\n单存档已覆盖至存档"+h)}},function(){});break;case 4:core.download(core.firstData.name+"_"+core.formatDate2(new Date())+".h5route",JSON.stringify({name:core.firstData.name,hard:core.status.hard,route:core.encodeRoute(core.status.route)}));break;case 5:core.status.event.selection=1;core.ui.drawConfirmBox("你确定要清空所有存档吗？",function(){localStorage.clear();core.drawText("\t[操作成功]你的所有存档已被清空。")},function(){core.status.event.selection=5;core.ui.drawSyncSave()});break;case 6:core.status.event.selection=3;core.ui.drawSettings();break}}return};events.prototype.keyDownSyncSave=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};events.prototype.keyUpSyncSave=function(b){if(b==27||b==88){core.status.event.selection=2;core.ui.drawSettings();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickSyncSave(6,c+core.status.event.selection)}};events.prototype.clickSyncSelect=function(d,e){if(d<5||d>7){return}var a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(e>=c&&e<c+a.length){var b=e-c;switch(b){case 0:core.syncSave("all");break;case 1:core.syncSave();break;case 2:core.status.event.selection=0;core.ui.drawSyncSave();break}}};events.prototype.keyDownSyncSelect=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};events.prototype.keyUpSyncSelect=function(b){if(b==27||b==88){core.status.event.selection=0;core.ui.drawSettings();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickSyncSelect(6,c+core.status.event.selection)}};events.prototype.clickLocalSaveSelect=function(h,j){if(h<5||h>7){return}var a=core.status.event.ui.choices;var g=6-parseInt((a.length-1)/2);var e=null;if(j>=g&&j<g+a.length){var f=j-g;switch(f){case 0:e=[];for(var d=1;d<=150;d++){var c=core.getLocalStorage("save"+d,null);if(core.isset(c)){e.push(c)}}break;case 1:for(var d=150;d>=1;d--){e=core.getLocalStorage("save"+d,null);if(core.isset(e)){break}}break;case 2:break}}if(core.isset(e)){var b={name:core.firstData.name,version:core.firstData.version,data:e};core.download(core.firstData.name+"_"+core.formatDate2(new Date())+".h5save",JSON.stringify(b))}core.status.event.selection=2;core.ui.drawSyncSave()};events.prototype.keyDownLocalSaveSelect=function(a){if(a==38){core.status.event.selection--;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}if(a==40){core.status.event.selection++;core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}};events.prototype.keyUpLocalSaveSelect=function(b){if(b==27||b==88){core.status.event.selection=0;core.ui.drawSettings();return}var a=core.status.event.ui.choices;if(b==13||b==32||b==67){var c=6-parseInt((a.length-1)/2);this.clickLocalSaveSelect(6,c+core.status.event.selection)}};events.prototype.clickKeyBoard=function(b,c){if(c==3&&b>=1&&b<=11){core.ui.closePanel();core.keyUp(112+b-1)}if(c==4&&b>=1&&b<=10){core.ui.closePanel();core.keyUp(b==10?48:48+b)}var a=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M"],];if(c==5&&b>=1&&b<=10){core.ui.closePanel();core.keyUp(a[0][b-1].charCodeAt(0))}if(c==6&&b>=1&&b<=9){core.ui.closePanel();core.keyUp(a[1][b-1].charCodeAt(0))}if(c==7&&b>=1&&b<=7){core.ui.closePanel();core.keyUp(a[2][b-1].charCodeAt(0))}if(c==8&&b>=1&&b<=11){core.ui.closePanel();if(b==1){core.keyUp(189)}if(b==2){core.keyUp(187)}if(b==3){core.keyUp(219)}if(b==4){core.keyUp(221)}if(b==5){core.keyUp(220)}if(b==6){core.keyUp(186)}if(b==7){core.keyUp(222)}if(b==8){core.keyUp(188)}if(b==9){core.keyUp(190)}if(b==10){core.keyUp(191)}if(b==11){core.keyUp(192)}}if(c==9&&b>=1&&b<=10){core.ui.closePanel();if(b==1){core.keyUp(27)}if(b==2){core.keyUp(9)}if(b==3){core.keyUp(20)}if(b==4){core.keyUp(16)}if(b==5){core.keyUp(17)}if(b==6){core.keyUp(18)}if(b==7){core.keyUp(32)}if(b==8){core.keyUp(8)}if(b==9){core.keyUp(13)}if(b==10){core.keyUp(46)}}if(c==10&&b>=9&&b<=11){core.ui.closePanel()}};events.prototype.clickCursor=function(a,b){if(a==core.status.automaticRoute.cursorX&&b==core.status.automaticRoute.cursorY){core.ui.closePanel();core.onclick(a,b,[]);return}core.status.automaticRoute.cursorX=a;core.status.automaticRoute.cursorY=b;core.ui.drawCursor()};events.prototype.keyDownCursor=function(a){if(a==37){core.status.automaticRoute.cursorX--;core.ui.drawCursor();return}if(a==38){core.status.automaticRoute.cursorY--;core.ui.drawCursor();return}if(a==39){core.status.automaticRoute.cursorX++;core.ui.drawCursor();return}if(a==40){core.status.automaticRoute.cursorY++;core.ui.drawCursor();return}};events.prototype.keyUpCursor=function(a){if(a==27||a==88){core.ui.closePanel();return}if(a==13||a==32||a==67||a==69){core.ui.closePanel();core.onclick(core.status.automaticRoute.cursorX,core.status.automaticRoute.cursorY,[]);return}};events.prototype.clickAbout=function(){if(core.isPlaying()){core.ui.closePanel()}else{core.showStartAnimate()}};